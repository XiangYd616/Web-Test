# å®Œå¤‡æ•°æ®åº“ç®¡ç†æŒ‡å—

## æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«æµ‹è¯•å¹³å°çš„å®Œå¤‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒPostgreSQLæ•°æ®åº“çš„åˆå§‹åŒ–ã€ç®¡ç†ã€å¤‡ä»½å’Œç»´æŠ¤ã€‚

## ğŸ¯ é‡è¦å˜æ›´

**æ•°æ®åº“æ¶æ„å·²ç»Ÿä¸€ï¼** ç°åœ¨åªä½¿ç”¨ä¸€ä¸ªå®Œå¤‡çš„æ•°æ®åº“æ¶æ„æ–‡ä»¶ï¼š
- âœ… `complete-schema.sql` - å®Œå¤‡çš„ä¼ä¸šçº§æ•°æ®åº“æ¶æ„ï¼ˆ37ä¸ªè¡¨ + ç´¢å¼• + è§¦å‘å™¨ + å‡½æ•°ï¼‰
- âŒ `schema.sql` - å·²åˆ é™¤ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
- âŒ `optimized-schema.sql` - å·²åˆ é™¤ï¼ˆæ—§ç‰ˆæœ¬ï¼‰

## æ–‡ä»¶ç»“æ„

```
database/
â”œâ”€â”€ README.md              # æœ¬æ–‡æ¡£
â”œâ”€â”€ SETUP_GUIDE.md        # è¯¦ç»†å®‰è£…æŒ‡å—
â”œâ”€â”€ config.js              # æ•°æ®åº“è¿æ¥é…ç½®
â”œâ”€â”€ init.js                # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ manage.js              # ä¼ ç»Ÿæ•°æ®åº“ç®¡ç†è„šæœ¬
â”œâ”€â”€ complete-manage.js     # å®Œå¤‡æ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰
â”œâ”€â”€ test-connection.js     # è¿æ¥æµ‹è¯•å·¥å…·
â”œâ”€â”€ complete-schema.sql    # å®Œå¤‡æ•°æ®åº“æ¶æ„å®šä¹‰ï¼ˆå”¯ä¸€æ¶æ„æ–‡ä»¶ï¼‰
â”œâ”€â”€ initial_data.sql       # åˆå§‹æ•°æ®ï¼ˆå·²é›†æˆåˆ°complete-schema.sqlï¼‰
â””â”€â”€ backups/               # å¤‡ä»½æ–‡ä»¶ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

## ğŸš€ å®Œå¤‡æ•°æ®åº“ç‰¹æ€§

### æ ¸å¿ƒæ¨¡å—
1. **ç”¨æˆ·ç®¡ç†æ¨¡å—** - å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€æƒé™ã€ä¼šè¯ç®¡ç†
2. **æµ‹è¯•ç®¡ç†æ¨¡å—** - å…¨é¢çš„æµ‹è¯•æ‰§è¡Œã€ç»“æœã€æŠ¥å‘Šç®¡ç†
3. **ç›‘æ§ç®¡ç†æ¨¡å—** - ç½‘ç«™ç›‘æ§ã€æ€§èƒ½è·Ÿè¸ª
4. **ç³»ç»Ÿç®¡ç†æ¨¡å—** - é…ç½®ç®¡ç†ã€ç»Ÿè®¡åˆ†æ

### æŠ€æœ¯ç‰¹æ€§
- ğŸ”§ **37ä¸ªä¸šåŠ¡è¡¨** - è¦†ç›–æ‰€æœ‰ä¸šåŠ¡åœºæ™¯
- ğŸš€ **å®Œæ•´ç´¢å¼•ä¼˜åŒ–** - æŸ¥è¯¢æ€§èƒ½æœ€ä¼˜
- âš¡ **è‡ªåŠ¨è§¦å‘å™¨** - æ•°æ®ä¸€è‡´æ€§ä¿è¯
- ğŸ” **å†…ç½®è§†å›¾** - ä¾¿æ·çš„æ•°æ®æŸ¥è¯¢
- ğŸ§¹ **è‡ªåŠ¨æ¸…ç†** - è¿‡æœŸæ•°æ®è‡ªåŠ¨å¤„ç†
- ğŸ” **æƒé™æ§åˆ¶** - ç»†ç²’åº¦è®¿é—®æ§åˆ¶

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

1. **å®‰è£…PostgreSQL**
   ```bash
   # Ubuntu/Debian
   sudo apt-get install postgresql postgresql-contrib
   
   # macOS
   brew install postgresql
   
   # Windows
   # ä¸‹è½½å¹¶å®‰è£… PostgreSQL å®˜æ–¹å®‰è£…åŒ…
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
   cp database/.env.example database/.env
   
   # ç¼–è¾‘é…ç½®æ–‡ä»¶
   nano database/.env
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

### 2. æ•°æ®åº“åˆå§‹åŒ–

```bash
# å®Œæ•´åˆå§‹åŒ–ï¼ˆæ¨èï¼‰
npm run db:setup

# æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
npm run db:init          # åˆå§‹åŒ–æ•°æ®åº“ç»“æ„
npm run db:create-admin  # åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
```

### 3. éªŒè¯å®‰è£…

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
npm run db:test

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
npm run db:status
```

## å¯ç”¨å‘½ä»¤

### åŸºç¡€æ“ä½œ

| å‘½ä»¤ | æè¿° |
|------|------|
| `npm run db:init` | åˆå§‹åŒ–æ•°æ®åº“ç»“æ„å’Œæ•°æ® |
| `npm run db:status` | æ˜¾ç¤ºæ•°æ®åº“çŠ¶æ€ä¿¡æ¯ |
| `npm run db:test` | æµ‹è¯•æ•°æ®åº“è¿æ¥ |
| `npm run db:setup` | å®Œæ•´è®¾ç½®ï¼ˆåˆå§‹åŒ–+åˆ›å»ºç®¡ç†å‘˜ï¼‰ |

### ç”¨æˆ·ç®¡ç†

| å‘½ä»¤ | æè¿° |
|------|------|
| `npm run db:create-admin` | åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ· |

### æ•°æ®ç®¡ç†

| å‘½ä»¤ | æè¿° |
|------|------|
| `npm run db:backup` | å¤‡ä»½æ•°æ®åº“ |
| `npm run db:clean` | æ¸…ç†æµ‹è¯•æ•°æ® |
| `npm run db:reset` | é‡ç½®æ•°æ®åº“ï¼ˆå±é™©æ“ä½œï¼‰ |

### ä¼ ç»Ÿå‘½ä»¤ï¼ˆå…¼å®¹æ€§ï¼‰

| å‘½ä»¤ | æè¿° |
|------|------|
| `npm run db:init:legacy` | ä½¿ç”¨æ—§ç‰ˆåˆå§‹åŒ–è„šæœ¬ |
| `npm run db:backup:legacy` | ä½¿ç”¨æ—§ç‰ˆå¤‡ä»½è„šæœ¬ |
| `npm run db:health` | å¥åº·æ£€æŸ¥ |
| `npm run db:manager` | æ•°æ®åº“ç®¡ç†å™¨ |

## æ•°æ®åº“æ¶æ„

### æ ¸å¿ƒè¡¨

1. **users** - ç”¨æˆ·ä¿¡æ¯
2. **test_projects** - æµ‹è¯•é¡¹ç›®
3. **test_configurations** - æµ‹è¯•é…ç½®
4. **test_executions** - æµ‹è¯•æ‰§è¡Œè®°å½•

### ç»“æœè¡¨

1. **performance_test_results** - æ€§èƒ½æµ‹è¯•ç»“æœ
2. **security_test_results** - å®‰å…¨æµ‹è¯•ç»“æœ
3. **api_test_results** - APIæµ‹è¯•ç»“æœ
4. **stress_test_results** - å‹åŠ›æµ‹è¯•ç»“æœ
5. **compatibility_test_results** - å…¼å®¹æ€§æµ‹è¯•ç»“æœ
6. **seo_test_results** - SEOæµ‹è¯•ç»“æœ
7. **ux_test_results** - ç”¨æˆ·ä½“éªŒæµ‹è¯•ç»“æœ
8. **infrastructure_test_results** - åŸºç¡€è®¾æ–½æµ‹è¯•ç»“æœ

### ç®¡ç†è¡¨

1. **test_reports** - æµ‹è¯•æŠ¥å‘Š
2. **user_statistics** - ç”¨æˆ·ç»Ÿè®¡
3. **system_configurations** - ç³»ç»Ÿé…ç½®

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“è¿æ¥
DB_HOST=localhost          # æ•°æ®åº“ä¸»æœº
DB_PORT=5432              # æ•°æ®åº“ç«¯å£
DB_NAME=test_platform     # æ•°æ®åº“åç§°
DB_USER=postgres          # æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD=your_password # æ•°æ®åº“å¯†ç 
DB_SSL=false              # æ˜¯å¦å¯ç”¨SSL

# è¿æ¥æ± é…ç½®
DB_MAX_CONNECTIONS=20     # æœ€å¤§è¿æ¥æ•°
DB_IDLE_TIMEOUT_MS=30000  # ç©ºé—²è¶…æ—¶
DB_CONNECTION_TIMEOUT_MS=2000  # è¿æ¥è¶…æ—¶

# å¤‡ä»½é…ç½®
BACKUP_DIR=./backups      # å¤‡ä»½ç›®å½•
BACKUP_RETENTION_DAYS=30  # å¤‡ä»½ä¿ç•™å¤©æ•°
```

### æ•°æ®åº“æƒé™

ç¡®ä¿æ•°æ®åº“ç”¨æˆ·å…·æœ‰ä»¥ä¸‹æƒé™ï¼š
- CREATE DATABASE
- CREATE TABLE
- INSERT, UPDATE, DELETE, SELECT
- CREATE INDEX
- CREATE FUNCTION, CREATE TRIGGER

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
   sudo systemctl status postgresql
   
   # å¯åŠ¨PostgreSQLæœåŠ¡
   sudo systemctl start postgresql
   ```

2. **æƒé™é”™è¯¯**
   ```sql
   -- æˆäºˆç”¨æˆ·æƒé™
   GRANT ALL PRIVILEGES ON DATABASE test_platform TO your_user;
   ```

3. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep 5432
   
   # ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£
   ```

### æ—¥å¿—æŸ¥çœ‹

```bash
# PostgreSQLæ—¥å¿—ä½ç½®
# Ubuntu/Debian: /var/log/postgresql/
# macOS: /usr/local/var/log/
# Windows: PostgreSQLå®‰è£…ç›®å½•/data/log/

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f /var/log/postgresql/postgresql-*.log
```

## ç»´æŠ¤å»ºè®®

### å®šæœŸç»´æŠ¤

1. **æ¯æ—¥**
   - æ£€æŸ¥æ•°æ®åº“çŠ¶æ€ï¼š`npm run db:status`
   - ç›‘æ§è¿æ¥æ•°å’Œæ€§èƒ½

2. **æ¯å‘¨**
   - å¤‡ä»½æ•°æ®åº“ï¼š`npm run db:backup`
   - æ¸…ç†è¿‡æœŸæµ‹è¯•æ•°æ®ï¼š`npm run db:clean`

3. **æ¯æœˆ**
   - åˆ†ææ•°æ®åº“æ€§èƒ½ï¼š`npm run db:analyze`
   - æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼š`npm run db:integrity`

### æ€§èƒ½ä¼˜åŒ–

1. **ç´¢å¼•ä¼˜åŒ–**
   ```sql
   -- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
   SELECT * FROM pg_stat_user_indexes;
   
   -- é‡å»ºç´¢å¼•
   REINDEX DATABASE test_platform;
   ```

2. **æ¸…ç†æ— ç”¨æ•°æ®**
   ```sql
   -- æ¸…ç†90å¤©å‰çš„æµ‹è¯•ç»“æœ
   DELETE FROM test_executions 
   WHERE completed_at < NOW() - INTERVAL '90 days';
   ```

## å®‰å…¨å»ºè®®

1. **å¯†ç å®‰å…¨**
   - ä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 

2. **ç½‘ç»œå®‰å…¨**
   - é™åˆ¶æ•°æ®åº“è®¿é—®IP
   - ä½¿ç”¨SSLè¿æ¥ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   - é…ç½®é˜²ç«å¢™è§„åˆ™

3. **å¤‡ä»½å®‰å…¨**
   - åŠ å¯†å¤‡ä»½æ–‡ä»¶
   - å¼‚åœ°å­˜å‚¨å¤‡ä»½
   - å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹

## æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥PostgreSQLå®˜æ–¹æ–‡æ¡£
3. æŸ¥çœ‹é¡¹ç›®issueæˆ–æäº¤æ–°issue

## æ›´æ–°æ—¥å¿—

- **v1.0.0** - åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒå®Œæ•´çš„æ•°æ®åº“ç®¡ç†åŠŸèƒ½
