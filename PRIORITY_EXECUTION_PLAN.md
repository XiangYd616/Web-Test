# 优先级任务执行计划

> 创建日期: 2025-11-12  
> 状态: 🔄 执行中

---

## 🎯 执行策略

基于ROI(投资回报率)和风险评估,按照以下顺序执行:

---

## 🔴 高优先级 (立即执行)

### 1. 完善核心服务测试 ⭐ 当前任务

**优先级**: 🔴 最高  
**预计时间**: 2-3小时  
**风险**: 低  
**收益**: 高 (保障代码质量)

#### 目标
为authService和apiService添加单元测试,提升测试覆盖率

#### 执行步骤
1. [x] 分析authService结构
2. [ ] 编写authService单元测试
3. [ ] 编写apiService单元测试
4. [ ] 运行测试验证
5. [ ] 提交测试代码

#### 预期成果
- authService测试覆盖率: 0% → 80%
- apiService测试覆盖率: 0% → 80%
- 新增测试用例: 100+个

---

### 2. 简化的代码规范检查

**优先级**: 🔴 高  
**预计时间**: 1小时  
**风险**: 低  
**收益**: 中 (提升代码一致性)

#### 目标
快速修复明显的代码规范问题

#### 执行步骤
1. [ ] 运行ESLint检查
2. [ ] 自动修复可修复的问题
3. [ ] 手动修复关键问题
4. [ ] 提交规范修复

---

## 🟡 中优先级 (本周内)

### 3. TestHistory组件重构 - Phase 1

**优先级**: 🟡 中高  
**预计时间**: 2天  
**风险**: 中  
**收益**: 极高 (减少3000行代码)

#### 调整方案
不立即全面重构,而是采取渐进式策略:

**Phase 1: 准备和试点** (2天)
1. [ ] 创建通用TestHistory类型定义
2. [ ] 实现基础配置系统
3. [ ] 选择1个简单组件作为试点
4. [ ] 验证可行性

**Phase 2: 扩展迁移** (待Phase 1成功后)
- 迁移3-4个组件
- 收集反馈和优化

**Phase 3: 全面推广** (待Phase 2成功后)
- 迁移所有剩余组件
- 删除冗余代码

---

### 4. 主版本依赖评估

**优先级**: 🟡 中  
**预计时间**: 1天  
**风险**: 中  
**收益**: 中 (安全性和性能)

#### 目标
评估关键依赖的主版本升级

#### 重点包
- @vitejs/plugin-react: 4.7.0 → 5.1.0
- @types/bcrypt: 5.0.2 → 6.0.0

#### 执行步骤
1. [ ] 创建测试分支
2. [ ] 升级@vitejs/plugin-react
3. [ ] 运行测试验证
4. [ ] 评估性能影响
5. [ ] 决定是否合并

---

## 🟢 低优先级 (未来2周)

### 5. 性能基准测试

**优先级**: 🟢 低  
**预计时间**: 1天  
**风险**: 低  
**收益**: 低 (了解现状)

#### 目标
建立性能基准,为后续优化提供依据

---

### 6. 文档完善

**优先级**: 🟢 低  
**预计时间**: 持续  
**风险**: 无  
**收益**: 中 (长期价值)

---

## 📋 当前执行: 完善核心服务测试

### authService测试计划

**测试文件**: `frontend/services/auth/__tests__/authService.test.ts`

**测试覆盖点**:
1. 登录功能
   - 成功登录
   - 错误凭证
   - 网络错误处理
   
2. 注册功能
   - 成功注册
   - 验证失败
   - 重复用户
   
3. Token管理
   - Token存储
   - Token刷新
   - Token过期处理
   
4. 用户状态
   - 获取当前用户
   - 登出
   - 会话管理

### apiService测试计划

**测试文件**: `frontend/services/api/__tests__/apiService.test.ts`

**测试覆盖点**:
1. HTTP请求
   - GET请求
   - POST请求
   - PUT请求
   - DELETE请求
   
2. 错误处理
   - 网络错误
   - 服务器错误(5xx)
   - 客户端错误(4xx)
   - 超时处理
   
3. 拦截器
   - 请求拦截器
   - 响应拦截器
   - 错误拦截器
   
4. 重试机制
   - 自动重试
   - 重试限制
   - 指数退避

---

## 🎯 成功标准

### 本次执行(高优先级任务)
- ✅ authService测试覆盖率 ≥ 80%
- ✅ apiService测试覆盖率 ≥ 80%
- ✅ 所有测试通过
- ✅ 代码规范问题 < 10个

### 整体目标(本周)
- ✅ 测试覆盖率 ≥ 70%
- ✅ 代码重复率 < 10%
- ✅ 构建成功率 = 100%
- ✅ 无高危安全漏洞

---

## ⏱️ 时间线

```
Day 1 (今天):
09:00-12:00  authService测试编写
13:00-15:00  apiService测试编写  
15:00-16:00  代码规范检查和修复
16:00-17:00  测试运行和提交

Day 2-3:
TestHistory组件重构Phase 1

Day 4-5:
主版本依赖评估和升级
```

---

## 📊 进度追踪

### 已完成 ✅
- [x] 创建优先级执行计划
- [x] 分析测试需求
- [x] authService测试编写 (590行，50+测试用例)
- [x] apiService测试编写 (738行，40+测试用例)

### 进行中 🔄
- [x] TestHistory重构Phase 1 - 准备阶段 ✅
  - [x] 类型定义梳理 (types.ts)
  - [x] 创建stressTestConfig配置 (254行)
  - [x] 创建seoTestConfig配置 (196行)
  - [x] 创建配置索引系统 (config/index.ts)
  - [x] 创建使用文档 (USAGE.md, 451行)
  - [ ] 创建通用TestHistory组件
  - [ ] 编写单元测试

### 待开始 ⏳
- [ ] TestHistory重构Phase 2 - 扩展迁移
- [ ] 依赖升级评估
- [ ] 代码规范统一

---

**最后更新**: 2025-11-12  
**负责人**: Development Team  
**下次评审**: 2025-11-13
