# æ•°æ®åº“è®¾ç½®æŒ‡å—

## ğŸŒ åŒæ•°æ®åº“æ¶æ„

é¡¹ç›®é‡‡ç”¨**åŒæ•°æ®åº“æ¶æ„**ï¼Œè‡ªåŠ¨ç¯å¢ƒåˆ‡æ¢ï¼š

| ç¯å¢ƒ | æ•°æ®åº“å | ç”¨é€” |
|------|----------|------|
| å¼€å‘ç¯å¢ƒ | `testweb_dev` | æ—¥å¸¸å¼€å‘ã€æµ‹è¯• |
| ç”Ÿäº§ç¯å¢ƒ | `testweb_prod` | æ­£å¼éƒ¨ç½²ã€ç”¨æˆ·ä½¿ç”¨ |

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®
ç¡®ä¿å·²æ­£ç¡®é…ç½® `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š
```env
# æ•°æ®åº“é…ç½® - å¼€å‘ç¯å¢ƒ
DB_HOST=localhost
DB_PORT=5432
DB_NAME=testweb_dev
DB_USER=postgres
DB_PASSWORD=postgres
```

### 2. åˆ›å»ºæ•°æ®åº“
```bash
# åˆ›å»ºå¼€å‘æ•°æ®åº“
psql -U postgres -c "CREATE DATABASE testweb_dev;"

# åˆ›å»ºç”Ÿäº§æ•°æ®åº“ (å¯é€‰)
psql -U postgres -c "CREATE DATABASE testweb_prod;"
```

### 3. åˆå§‹åŒ–æ•°æ®åº“
```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# éªŒè¯ç¯å¢ƒå˜é‡
npm run validate-env

# åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
npm run init-db

# å¯åŠ¨åº”ç”¨
npm start
```

### 4. ä¸€é”®è®¾ç½®ï¼ˆæ¨èï¼‰
```bash
# éªŒè¯ç¯å¢ƒ + åˆå§‹åŒ–æ•°æ®åº“ + å¯åŠ¨åº”ç”¨
npm run setup
```

## æ•°æ®åº“è„šæœ¬å‘½ä»¤

### åŸºæœ¬å‘½ä»¤
```bash
# éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
npm run validate-env

# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå®‰å…¨ï¼Œä¸ä¼šåˆ é™¤ç°æœ‰æ•°æ®ï¼‰
npm run init-db

# é‡ç½®æ•°æ®åº“ï¼ˆå±é™©ï¼ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
npm run reset-db

# å®Œæ•´é‡ç½®å¹¶åˆå§‹åŒ–
npm run setup-fresh

# æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
npm run check-health
```

### æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬
```bash
# ç›´æ¥è¿è¡Œåˆå§‹åŒ–è„šæœ¬
node scripts/init-database.js

# ç›´æ¥è¿è¡Œé‡ç½®è„šæœ¬
node scripts/reset-database.js

# éªŒè¯ç¯å¢ƒå˜é‡
node scripts/validate-env.js
```

## æ•°æ®åº“è¡¨ç»“æ„

### æ ¸å¿ƒè¡¨
- **users** - ç”¨æˆ·è´¦æˆ·ä¿¡æ¯
- **user_preferences** - ç”¨æˆ·åå¥½è®¾ç½®
- **test_results** - æµ‹è¯•ç»“æœæ•°æ®
- **activity_logs** - ç”¨æˆ·æ´»åŠ¨æ—¥å¿—

### ç›‘æ§ç›¸å…³
- **monitoring_sites** - ç›‘æ§ç«™ç‚¹é…ç½®
- **monitoring_results** - ç›‘æ§æ£€æŸ¥ç»“æœ

### æ•°æ®ç®¡ç†
- **data_tasks** - æ•°æ®å¯¼å…¥å¯¼å‡ºä»»åŠ¡
- **test_templates** - æµ‹è¯•æ¨¡æ¿
- **system_settings** - ç³»ç»Ÿé…ç½®
- **notifications** - é€šçŸ¥æ¶ˆæ¯

## æ•°æ®åº“ç‰¹æ€§

### è‡ªåŠ¨åŠŸèƒ½
- âœ… UUIDä¸»é”®
- âœ… è‡ªåŠ¨æ—¶é—´æˆ³ï¼ˆcreated_at, updated_atï¼‰
- âœ… å¤–é”®çº¦æŸ
- âœ… æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- âœ… æ€§èƒ½ä¼˜åŒ–ç´¢å¼•

### å®‰å…¨ç‰¹æ€§
- ğŸ”’ å¯†ç å“ˆå¸Œå­˜å‚¨
- ğŸ”’ ç”¨æˆ·æ•°æ®éš”ç¦»
- ğŸ”’ SQLæ³¨å…¥é˜²æŠ¤
- ğŸ”’ æ•°æ®éªŒè¯çº¦æŸ

### æ€§èƒ½ä¼˜åŒ–
- ğŸ“ˆ å…³é”®å­—æ®µç´¢å¼•
- ğŸ“ˆ æŸ¥è¯¢ä¼˜åŒ–
- ğŸ“ˆ è¿æ¥æ± ç®¡ç†
- ğŸ“ˆ äº‹åŠ¡æ”¯æŒ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥å¤±è´¥
```
âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: connection refused
```
**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥PostgreSQLæœåŠ¡æ˜¯å¦è¿è¡Œ
- éªŒè¯è¿æ¥é…ç½®ï¼ˆä¸»æœºã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼‰
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 2. æƒé™é”™è¯¯
```
âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: permission denied
```
**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰åˆ›å»ºè¡¨çš„æƒé™
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
- éªŒè¯ç”¨æˆ·è§’è‰²æƒé™

#### 3. è¡¨å·²å­˜åœ¨
```
âš ï¸ æ•°æ®åº“è¡¨å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–
```
**è¯´æ˜ï¼š** è¿™æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œè¡¨ç¤ºæ•°æ®åº“å·²åˆå§‹åŒ–

#### 4. ç‰ˆæœ¬ä¸å…¼å®¹
```
âŒ PostgreSQLç‰ˆæœ¬ä¸æ”¯æŒ
```
**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿PostgreSQLç‰ˆæœ¬ >= 12
- æ£€æŸ¥uuid-osspæ‰©å±•æ˜¯å¦å¯ç”¨

### è°ƒè¯•æ­¥éª¤

1. **æ£€æŸ¥ç¯å¢ƒå˜é‡**
```bash
npm run validate-env
```

2. **æµ‹è¯•æ•°æ®åº“è¿æ¥**
```bash
psql -h localhost -U postgres -d testweb_prod -c "SELECT version();"
```

3. **æŸ¥çœ‹è¡¨ç»“æ„**
```bash
psql -h localhost -U postgres -d testweb_prod -c "\dt"
```

4. **æ£€æŸ¥æ—¥å¿—**
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log
```

## æ•°æ®å¤‡ä»½ä¸æ¢å¤

### å¤‡ä»½æ•°æ®åº“
```bash
# å®Œæ•´å¤‡ä»½
pg_dump -h localhost -U postgres testweb_prod > backup.sql

# ä»…æ•°æ®å¤‡ä»½
pg_dump -h localhost -U postgres --data-only testweb_prod > data_backup.sql

# ä»…ç»“æ„å¤‡ä»½
pg_dump -h localhost -U postgres --schema-only testweb_prod > schema_backup.sql
```

### æ¢å¤æ•°æ®åº“
```bash
# æ¢å¤å®Œæ•´å¤‡ä»½
psql -h localhost -U postgres testweb_prod < backup.sql

# æ¢å¤æ•°æ®
psql -h localhost -U postgres testweb_prod < data_backup.sql
```

## å¼€å‘å»ºè®®

### æ•°æ®åº“è¿ç§»
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†SQLè„šæœ¬
- æµ‹è¯•è¿ç§»è„šæœ¬çš„å‘å‰å’Œå‘åå…¼å®¹æ€§
- åœ¨ç”Ÿäº§ç¯å¢ƒå‰å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

### æ€§èƒ½ç›‘æ§
- å®šæœŸæ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—
- ç›‘æ§è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
- ä¼˜åŒ–é¢‘ç¹æŸ¥è¯¢çš„ç´¢å¼•

### å®‰å…¨æœ€ä½³å®è·µ
- å®šæœŸæ›´æ–°æ•°æ®åº“å¯†ç 
- é™åˆ¶æ•°æ®åº“ç”¨æˆ·æƒé™
- å¯ç”¨SSLè¿æ¥ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- å®šæœŸå¤‡ä»½æ•°æ®

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] å¤‡ä»½ç­–ç•¥å·²åˆ¶å®š
- [ ] ç›‘æ§ç³»ç»Ÿå·²é…ç½®
- [ ] SSLè¯ä¹¦å·²å®‰è£…

### éƒ¨ç½²æ­¥éª¤
1. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
2. è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–
3. éªŒè¯è¡¨ç»“æ„å’Œæ•°æ®
4. å¯åŠ¨åº”ç”¨æœåŠ¡
5. æ‰§è¡Œå¥åº·æ£€æŸ¥
6. é…ç½®ç›‘æ§å’Œå‘Šè­¦

### ç»´æŠ¤ä»»åŠ¡
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- ç›‘æ§æ€§èƒ½æŒ‡æ ‡
- æ¸…ç†è¿‡æœŸæ—¥å¿—
- æ›´æ–°å®‰å…¨é…ç½®
