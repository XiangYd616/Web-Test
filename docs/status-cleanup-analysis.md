# å‹åŠ›æµ‹è¯•çŠ¶æ€æ¸…ç†åˆ†ææŠ¥å‘Š

## ğŸ“‹ å½“å‰çŠ¶æ€æ¦‚è§ˆ

æ ¹æ®ä»£ç åˆ†æï¼Œå½“å‰ç³»ç»Ÿä¸­å®šä¹‰äº†ä»¥ä¸‹æµ‹è¯•çŠ¶æ€ï¼š

### å‰ç«¯å®šä¹‰çš„çŠ¶æ€
```typescript
// src/services/stressTestRecordService.ts (ç¬¬34è¡Œ)
status: 'pending' | 'running' | 'completed' | 'failed' | 'cancelled' | 'waiting' | 'timeout';
```

### æ•°æ®åº“å®šä¹‰çš„çŠ¶æ€
```sql
-- server/scripts/enhance-test-history.sql (ç¬¬24è¡Œ)
status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'running', 'completed', 'failed', 'cancelled', 'timeout'))
```

### UI ä¸­æ˜¾ç¤ºçš„çŠ¶æ€
ä» `StressTestHistory.tsx` ä¸­çš„ç­›é€‰é€‰é¡¹ï¼š
- `completed` - å·²å®Œæˆ
- `failed` - å·²å¤±è´¥  
- `running` - è¿è¡Œä¸­
- `cancelled` - å·²å–æ¶ˆ
- `waiting` - ç­‰å¾…ä¸­
- `pending` - å‡†å¤‡ä¸­
- `timeout` - è¶…æ—¶

## ğŸ” çŠ¶æ€ä½¿ç”¨æƒ…å†µåˆ†æ

### 1. æ ¸å¿ƒçŠ¶æ€ï¼ˆå¿…éœ€ä¿ç•™ï¼‰
- âœ… **pending** - å‡†å¤‡ä¸­ï¼šæµ‹è¯•åˆ›å»ºä½†æœªå¼€å§‹
- âœ… **running** - è¿è¡Œä¸­ï¼šæµ‹è¯•æ­£åœ¨æ‰§è¡Œ
- âœ… **completed** - å·²å®Œæˆï¼šæµ‹è¯•æˆåŠŸå®Œæˆ
- âœ… **failed** - å·²å¤±è´¥ï¼šæµ‹è¯•æ‰§è¡Œå¤±è´¥
- âœ… **cancelled** - å·²å–æ¶ˆï¼šç”¨æˆ·æ‰‹åŠ¨å–æ¶ˆ

### 2. å¯ç–‘çŠ¶æ€ï¼ˆéœ€è¦è¯„ä¼°ï¼‰
- â“ **waiting** - ç­‰å¾…ä¸­ï¼šåœ¨ä»£ç ä¸­æœ‰å®šä¹‰å’Œå¤„ç†é€»è¾‘
- â“ **timeout** - è¶…æ—¶ï¼šåœ¨æ•°æ®åº“çº¦æŸä¸­å®šä¹‰ï¼Œä½†ä½¿ç”¨è¾ƒå°‘

## ğŸ” è¯¦ç»†çŠ¶æ€åˆ†æ

### `waiting` çŠ¶æ€åˆ†æ

**å®šä¹‰ä½ç½®**ï¼š
- `useStressTestRecord.ts` ç¬¬98è¡Œï¼šçŠ¶æ€è½¬æ¢è§„åˆ™ä¸­åŒ…å«
- `StressTestHistory.tsx` ç¬¬401è¡Œï¼šUIç­›é€‰é€‰é¡¹ä¸­åŒ…å«
- æœåŠ¡å±‚æœ‰ `setTestWaiting()` å’Œ `startFromWaitingRecord()` æ–¹æ³•

**ä½¿ç”¨åœºæ™¯**ï¼š
- æµ‹è¯•æ’é˜Ÿç­‰å¾…æ‰§è¡Œ
- èµ„æºä¸è¶³æ—¶æš‚åœæµ‹è¯•
- æ‰‹åŠ¨æš‚åœæµ‹è¯•

**è¯„ä¼°ç»“æœ**ï¼šâœ… **å»ºè®®ä¿ç•™** - æœ‰å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘æ”¯æŒ

### `timeout` çŠ¶æ€åˆ†æ

**å®šä¹‰ä½ç½®**ï¼š
- æ•°æ®åº“çº¦æŸä¸­å®šä¹‰
- å‰ç«¯ç±»å‹å®šä¹‰ä¸­åŒ…å«
- çŠ¶æ€è½¬æ¢è§„åˆ™ä¸­åŒ…å«

**ä½¿ç”¨åœºæ™¯**ï¼š
- æµ‹è¯•æ‰§è¡Œè¶…æ—¶è‡ªåŠ¨ç»ˆæ­¢
- é•¿æ—¶é—´æ— å“åº”çš„æµ‹è¯•

**è¯„ä¼°ç»“æœ**ï¼šâœ… **å»ºè®®ä¿ç•™** - æ˜¯é‡è¦çš„å¼‚å¸¸çŠ¶æ€

## ğŸ“Š æ•°æ®åº“çŠ¶æ€ç»Ÿè®¡æŸ¥è¯¢

ä¸ºäº†äº†è§£å®é™…ä½¿ç”¨æƒ…å†µï¼Œå»ºè®®æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š

```sql
-- æŸ¥çœ‹å„çŠ¶æ€çš„è®°å½•æ•°é‡
SELECT 
    status,
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) as percentage
FROM test_history 
WHERE test_type = 'stress'
GROUP BY status 
ORDER BY count DESC;

-- æŸ¥çœ‹æœ€è¿‘30å¤©çš„çŠ¶æ€åˆ†å¸ƒ
SELECT 
    status,
    COUNT(*) as count,
    MIN(created_at) as first_seen,
    MAX(created_at) as last_seen
FROM test_history 
WHERE test_type = 'stress' 
    AND created_at >= NOW() - INTERVAL '30 days'
GROUP BY status 
ORDER BY count DESC;

-- æŸ¥çœ‹çŠ¶æ€è½¬æ¢æ—¥å¿—
SELECT 
    from_status,
    to_status,
    COUNT(*) as transition_count
FROM test_status_logs tsl
JOIN test_history th ON tsl.test_history_id = th.id
WHERE th.test_type = 'stress'
GROUP BY from_status, to_status
ORDER BY transition_count DESC;
```

## ğŸ§¹ æ¸…ç†å»ºè®®

### æ–¹æ¡ˆ1ï¼šä¿å®ˆæ¸…ç†ï¼ˆæ¨èï¼‰
ä¿ç•™æ‰€æœ‰å½“å‰çŠ¶æ€ï¼Œä½†ä¼˜åŒ–æ˜¾ç¤ºå’Œå¤„ç†é€»è¾‘ï¼š

1. **ä¼˜åŒ–UIæ˜¾ç¤º**ï¼š
   - å°†ä¸å¸¸ç”¨çŠ¶æ€ï¼ˆå¦‚ `timeout`ï¼‰åˆå¹¶åˆ°"å…¶ä»–"åˆ†ç±»
   - åœ¨ç­›é€‰å™¨ä¸­æŒ‰ä½¿ç”¨é¢‘ç‡æ’åº

2. **å®Œå–„çŠ¶æ€å¤„ç†**ï¼š
   - ç¡®ä¿æ‰€æœ‰çŠ¶æ€éƒ½æœ‰å¯¹åº”çš„å›¾æ ‡å’Œæ ·å¼
   - ç»Ÿä¸€çŠ¶æ€æ–‡æœ¬æ˜¾ç¤º

### æ–¹æ¡ˆ2ï¼šæ¿€è¿›æ¸…ç†ï¼ˆéœ€è°¨æ…ï¼‰
å¦‚æœæ•°æ®åº“æŸ¥è¯¢æ˜¾ç¤ºæŸäº›çŠ¶æ€ä»æœªä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘ç§»é™¤ï¼š

1. **ç§»é™¤å€™é€‰**ï¼š
   - å¦‚æœ `waiting` çŠ¶æ€ä½¿ç”¨ç‡æä½ä¸”ä¸šåŠ¡ä¸éœ€è¦
   - å¦‚æœ `timeout` å¯ä»¥åˆå¹¶åˆ° `failed` çŠ¶æ€

2. **æ¸…ç†æ­¥éª¤**ï¼š
   ```sql
   -- 1. å¤‡ä»½ç°æœ‰æ•°æ®
   CREATE TABLE test_history_backup AS SELECT * FROM test_history;
   
   -- 2. æ›´æ–°åºŸå¼ƒçŠ¶æ€ä¸ºå¯¹åº”çš„ä¸»è¦çŠ¶æ€
   UPDATE test_history SET status = 'failed' WHERE status = 'timeout';
   
   -- 3. æ›´æ–°æ•°æ®åº“çº¦æŸ
   ALTER TABLE test_history DROP CONSTRAINT IF EXISTS test_history_status_check;
   ALTER TABLE test_history ADD CONSTRAINT test_history_status_check 
       CHECK (status IN ('pending', 'running', 'completed', 'failed', 'cancelled'));
   ```

## ğŸ¯ æ¨èçš„æœ€ç»ˆçŠ¶æ€é›†åˆ

åŸºäºåˆ†æï¼Œå»ºè®®ä¿ç•™ä»¥ä¸‹çŠ¶æ€ï¼š

```typescript
type TestStatus = 
  | 'pending'    // å‡†å¤‡ä¸­ - æµ‹è¯•å·²åˆ›å»ºï¼Œç­‰å¾…å¼€å§‹
  | 'running'    // è¿è¡Œä¸­ - æµ‹è¯•æ­£åœ¨æ‰§è¡Œ
  | 'waiting'    // ç­‰å¾…ä¸­ - æµ‹è¯•æš‚åœæˆ–æ’é˜Ÿ
  | 'completed'  // å·²å®Œæˆ - æµ‹è¯•æˆåŠŸå®Œæˆ
  | 'failed'     // å·²å¤±è´¥ - æµ‹è¯•æ‰§è¡Œå¤±è´¥
  | 'cancelled'  // å·²å–æ¶ˆ - ç”¨æˆ·æ‰‹åŠ¨å–æ¶ˆ
  | 'timeout';   // è¶…æ—¶ - æµ‹è¯•æ‰§è¡Œè¶…æ—¶
```

## ğŸ”§ å®æ–½æ­¥éª¤

### ç¬¬1æ­¥ï¼šæ•°æ®åˆ†æ
```bash
# æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œäº†è§£å®é™…çŠ¶æ€ä½¿ç”¨æƒ…å†µ
npm run db:analyze-status
```

### ç¬¬2æ­¥ï¼šUIä¼˜åŒ–
1. æ›´æ–°çŠ¶æ€ç­›é€‰å™¨çš„æ˜¾ç¤ºé¡ºåº
2. ç¡®ä¿æ‰€æœ‰çŠ¶æ€éƒ½æœ‰æ­£ç¡®çš„å›¾æ ‡å’Œé¢œè‰²
3. ç»Ÿä¸€çŠ¶æ€æ–‡æœ¬æ˜¾ç¤º

### ç¬¬3æ­¥ï¼šä»£ç æ¸…ç†
1. ç§»é™¤æœªä½¿ç”¨çš„çŠ¶æ€å¤„ç†ä»£ç 
2. æ›´æ–°ç±»å‹å®šä¹‰
3. æ›´æ–°æµ‹è¯•ç”¨ä¾‹

### ç¬¬4æ­¥ï¼šæ•°æ®åº“æ›´æ–°
1. å¤‡ä»½ç°æœ‰æ•°æ®
2. æ›´æ–°çŠ¶æ€çº¦æŸ
3. è¿ç§»åºŸå¼ƒçŠ¶æ€çš„æ•°æ®

## ğŸ“ çŠ¶æ€è¯­ä¹‰åŒ–å»ºè®®

ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œå»ºè®®ç»Ÿä¸€çŠ¶æ€çš„ä¸­æ–‡æ˜¾ç¤ºï¼š

```typescript
const statusLabels = {
  pending: 'å‡†å¤‡ä¸­',
  running: 'è¿è¡Œä¸­', 
  waiting: 'ç­‰å¾…ä¸­',
  completed: 'å·²å®Œæˆ',
  failed: 'å·²å¤±è´¥',
  cancelled: 'å·²å–æ¶ˆ',
  timeout: 'å·²è¶…æ—¶'
};
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**ï¼šä»»ä½•çŠ¶æ€æ¸…ç†éƒ½å¿…é¡»è€ƒè™‘ç°æœ‰æ•°æ®çš„å…¼å®¹æ€§
2. **ç”¨æˆ·ä½“éªŒ**ï¼šä¸è¦ç§»é™¤ç”¨æˆ·å¯èƒ½ä¾èµ–çš„çŠ¶æ€ç­›é€‰åŠŸèƒ½
3. **ä¸šåŠ¡é€»è¾‘**ï¼šç¡®ä¿çŠ¶æ€è½¬æ¢é€»è¾‘çš„å®Œæ•´æ€§
4. **æµ‹è¯•è¦†ç›–**ï¼šæ›´æ–°ç›¸å…³çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ğŸ¯ ç»“è®º

å½“å‰çš„çŠ¶æ€è®¾è®¡åŸºæœ¬åˆç†ï¼Œå»ºè®®é‡‡ç”¨**ä¿å®ˆæ¸…ç†æ–¹æ¡ˆ**ï¼š
- ä¿ç•™æ‰€æœ‰ç°æœ‰çŠ¶æ€
- ä¼˜åŒ–UIæ˜¾ç¤ºå’Œç”¨æˆ·ä½“éªŒ
- å®Œå–„çŠ¶æ€å¤„ç†é€»è¾‘
- é€šè¿‡æ•°æ®åˆ†ææŒ‡å¯¼æœªæ¥çš„ä¼˜åŒ–å†³ç­–

è¿™æ ·æ—¢ä¿è¯äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œåˆä¸ºæœªæ¥çš„ä¼˜åŒ–ç•™ä¸‹äº†ç©ºé—´ã€‚

## ğŸš€ ç«‹å³å¯æ‰§è¡Œçš„ä¼˜åŒ–

### 1. è¿è¡ŒçŠ¶æ€åˆ†æè„šæœ¬
```bash
# åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œåˆ†æè„šæœ¬
psql -d your_database -f server/scripts/analyze-test-status.sql > status-analysis-report.txt
```

### 2. ä¼˜åŒ–UIæ˜¾ç¤ºé¡ºåº
æ ¹æ®ä½¿ç”¨é¢‘ç‡é‡æ–°æ’åºç­›é€‰é€‰é¡¹ï¼š
```typescript
// å»ºè®®çš„æ˜¾ç¤ºé¡ºåºï¼ˆæŒ‰ä½¿ç”¨é¢‘ç‡ï¼‰
const statusOptions = [
  { value: 'all', label: 'å…¨éƒ¨çŠ¶æ€' },
  { value: 'completed', label: 'å·²å®Œæˆ' },    // æœ€å¸¸ç”¨
  { value: 'running', label: 'è¿è¡Œä¸­' },      // å½“å‰æ´»è·ƒ
  { value: 'failed', label: 'å·²å¤±è´¥' },       // éœ€è¦å…³æ³¨
  { value: 'cancelled', label: 'å·²å–æ¶ˆ' },    // ç”¨æˆ·æ“ä½œ
  { value: 'pending', label: 'å‡†å¤‡ä¸­' },      // ç­‰å¾…æ‰§è¡Œ
  { value: 'waiting', label: 'ç­‰å¾…ä¸­' },      // æš‚åœçŠ¶æ€
  { value: 'timeout', label: 'å·²è¶…æ—¶' }       // å¼‚å¸¸çŠ¶æ€
];
```

### 3. çŠ¶æ€é¢œè‰²ä¼˜åŒ–
ç¡®ä¿æ‰€æœ‰çŠ¶æ€éƒ½æœ‰åˆé€‚çš„è§†è§‰è¡¨ç¤ºï¼š
```css
.status-completed { color: #10b981; } /* ç»¿è‰² - æˆåŠŸ */
.status-running { color: #3b82f6; }   /* è“è‰² - è¿›è¡Œä¸­ */
.status-failed { color: #ef4444; }    /* çº¢è‰² - å¤±è´¥ */
.status-cancelled { color: #f59e0b; } /* é»„è‰² - å–æ¶ˆ */
.status-pending { color: #6b7280; }   /* ç°è‰² - ç­‰å¾… */
.status-waiting { color: #8b5cf6; }   /* ç´«è‰² - æš‚åœ */
.status-timeout { color: #f97316; }   /* æ©™è‰² - è¶…æ—¶ */
```
