# 🪟 窗口3 - Electron集成开发环境

## 📍 当前位置
- **工作目录**: `D:\myproject\Test-Web-electron`
- **Git 分支**: `feature/electron-integration`
- **主要职责**: Electron桌面应用集成、主进程开发、系统集成

## 🎯 工作目标
作为**窗口3 - Electron集成窗口**，专注于：
1. Electron主进程开发
2. 渲染进程通信
3. 系统级功能集成
4. 窗口管理
5. 应用打包和分发

## 🚀 快速启动

```bash
# 方式1: 完整开发模式（推荐）
npm run dev
# 同时启动前端(5174)和后端(3001)

# 方式2: 仅Electron开发
npm run electron:dev
# 需要前端服务已运行

# 方式3: 仅前端
npm run frontend
```

## 📂 项目结构
```
electron/               # Electron相关
├── main.js            # 主进程入口
├── preload.js         # 预加载脚本
├── windows/           # 窗口管理
├── ipc/               # IPC通信
└── utils/             # 工具函数

tools/electron/        # Electron工具
├── builder/           # 构建配置
└── scripts/           # 构建脚本

frontend/              # 前端代码（共享）
backend/               # 后端代码（共享）
```

## 🔧 常用命令

### 开发命令
```bash
# 完整开发环境
npm run dev

# 仅Electron
npm run electron:dev

# 仅启动Electron（不启动dev server）
npm run electron:start
```

### 构建命令
```bash
# 构建前端 + Electron
npm run electron:build

# 打包为安装程序
npm run electron:dist

# 平台特定构建
npm run electron:build:win
npm run electron:build:mac
npm run electron:build:linux
```

### 调试命令
```bash
# 开发者工具
Ctrl+Shift+I (在Electron窗口中)

# 主进程调试
npm run electron:debug
```

## 🖥️ Electron特性

### 主进程功能
- 窗口管理（创建、关闭、最小化等）
- 系统托盘
- 菜单栏
- 原生对话框
- 文件系统访问
- 系统通知

### 渲染进程通信
- IPC通信（主进程 ↔ 渲染进程）
- 上下文隔离
- 预加载脚本
- 安全策略

### 系统集成
- 自动更新
- 崩溃报告
- 性能监控
- 日志管理

## 📝 开发规范

### IPC通信示例
```javascript
// 主进程 (electron/main.js)
ipcMain.handle('get-data', async (event, arg) => {
  return await fetchData(arg);
});

// 渲染进程 (frontend/)
const data = await window.electron.getData(arg);
```

### 窗口管理
```javascript
// 创建新窗口
const win = new BrowserWindow({
  width: 1200,
  height: 800,
  webPreferences: {
    preload: path.join(__dirname, 'preload.js'),
    contextIsolation: true
  }
});
```

### 提交规范
```bash
git add electron/
git commit -m "feat(electron): 添加系统托盘功能"
git commit -m "fix(ipc): 修复主进程通信问题"
git commit -m "refactor(window): 重构窗口管理器"
```

## 🔗 与其他窗口的关系

### 窗口1 - 前端 (D:\myproject\Test-Web)
- 共享前端代码
- Electron渲染进程加载前端页面
- 端口: 5174（开发模式）

### 窗口2 - 后端 (D:\myproject\Test-Web-backend)
- Electron调用后端API
- 端口: 3001
- 可能需要本地API代理

### 窗口4 - 测试 (D:\myproject\Test-Web-testing)
- Electron应用的E2E测试
- 主进程单元测试

## 🔍 故障排查

### Electron无法启动
```bash
# 检查Node版本
node --version  # 需要 v18+

# 重新安装Electron
npm install electron --save-dev

# 清理缓存
npm cache clean --force
npm install
```

### 前端页面无法加载
```bash
# 确保前端服务正在运行
cd D:\myproject\Test-Web
npm run frontend

# 检查端口
netstat -ano | findstr :5174
```

### 打包失败
```bash
# 检查构建配置
cat package.json | grep "build"

# 清理dist目录
npm run clean
npm run electron:build
```

## 🎨 开发模式

### 开发服务器模式
```javascript
// 加载开发服务器
if (process.env.ELECTRON_IS_DEV === '1') {
  win.loadURL('http://localhost:5174');
} else {
  win.loadFile('dist/index.html');
}
```

### 热重载
- 前端代码: Vite HMR自动更新
- 主进程代码: 需要重启Electron
- 预加载脚本: 需要重启Electron

## 📚 相关文档

### Electron文档
- 官方文档: https://www.electronjs.org/docs
- API参考: https://www.electronjs.org/docs/latest/api/app

### 本地文档
- 项目README: `../README.md`
- Electron配置: `electron/README.md`
- 构建指南: `tools/electron/BUILD.md`

### Worktree相关
- 工作树列表: `git worktree list`
- 合并指南: `../.dev/WORKTREE_MERGE_GUIDE.md`
- 快速参考: `../.dev/QUICK_START_REFERENCE.md`

## 💡 开发提示

### 调试技巧
```bash
# 主进程日志
console.log() # 输出到终端

# 渲染进程日志
console.log() # 输出到开发者工具

# 使用调试器
npm run electron:debug
```

### 性能优化
- 使用懒加载
- 优化IPC通信
- 减少主进程负担
- 合理使用缓存

### 安全最佳实践
- ✅ 启用上下文隔离
- ✅ 使用预加载脚本
- ✅ 禁用Node集成（渲染进程）
- ✅ 验证所有IPC消息
- ✅ 使用内容安全策略(CSP)

## 🎯 当前任务建议

作为Electron集成窗口，可以专注于：

1. **主进程开发**
   - 窗口生命周期管理
   - 系统功能集成
   - IPC通信优化

2. **系统集成**
   - 文件系统操作
   - 系统通知
   - 托盘图标
   - 全局快捷键

3. **应用优化**
   - 启动性能优化
   - 内存使用优化
   - 包体积优化

4. **打包发布**
   - 配置electron-builder
   - 测试安装程序
   - 自动更新机制

## 🔒 安全配置

### 推荐配置
```javascript
webPreferences: {
  contextIsolation: true,
  nodeIntegration: false,
  preload: path.join(__dirname, 'preload.js'),
  sandbox: true
}
```

## 🚦 状态检查

```bash
# 检查Electron版本
npm list electron

# 检查构建配置
cat package.json | grep -A 30 '"build"'

# 测试开发环境
npm run electron:dev
```

## 📦 构建输出

```
dist-electron/
├── win-unpacked/      # Windows未打包版本
├── Test-Web-Setup.exe # Windows安装程序
├── Test-Web.dmg       # macOS安装程序
└── Test-Web.AppImage  # Linux安装程序
```

---

**最后更新**: 2025-10-06  
**分支**: feature/electron-integration  
**Electron版本**: 32.2.6  
**状态**: ✅ 开发就绪

**开始工作**: `npm run dev`

