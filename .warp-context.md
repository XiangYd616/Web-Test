# 🪟 窗口2 - 后端API开发环境

## 📍 当前位置
- **工作目录**: `D:\myproject\Test-Web-backend`
- **Git 分支**: `feature/backend-api-dev`
- **主要职责**: 后端API开发、数据库操作、业务逻辑

## 🎯 工作目标
作为**窗口2 - 后端API开发窗口**，专注于：
1. 后端API端点开发
2. 数据库Schema和迁移
3. 业务逻辑实现
4. WebSocket服务
5. 中间件和认证

## 🚀 快速启动
```bash
# 启动后端开发服务器（端口 3001）
npm run backend:dev

# 或标准启动
npm run backend
```

## 📂 项目结构
```
backend/
├── src/
│   ├── controllers/    # 控制器
│   ├── routes/         # 路由定义
│   ├── models/         # 数据模型
│   ├── services/       # 业务服务
│   ├── middleware/     # 中间件
│   ├── utils/          # 工具函数
│   └── app.js          # 应用入口
├── tests/              # 测试文件
├── config/             # 配置文件
└── migrations/         # 数据库迁移
```

## 🔧 常用命令

### 开发命令
```bash
# 开发模式（自动重启）
npm run backend:dev

# 标准启动
npm run backend

# 查看日志
npm run backend:logs
```

### 数据库命令
```bash
# 查看数据库状态
npm run db:status

# 执行迁移
npm run db:migrate

# 创建迁移
npm run db:create-migration

# 回滚迁移
npm run db:rollback

# 备份数据库
npm run db:backup
```

### 测试命令
```bash
# 运行后端测试
cd backend
npm test

# 监听模式
npm run test:watch

# 测试覆盖率
npm run test:coverage
```

## 🌐 API端点

### 基础URL
- 开发环境: `http://localhost:3001/api`
- Swagger文档: `http://localhost:3001/api-docs`

### 主要模块
- `/api/auth` - 认证相关
- `/api/users` - 用户管理
- `/api/tests` - 测试管理
- `/api/stress` - 压力测试
- `/api/seo` - SEO分析
- `/api/compatibility` - 兼容性测试

## 📝 开发规范

### 代码风格
- 使用 ESM 模块语法
- 遵循 REST API 规范
- 使用异步/await
- 统一错误处理

### 提交规范
```bash
git add backend/
git commit -m "feat(api): 添加用户认证API"
git commit -m "fix(db): 修复数据库连接问题"
git commit -m "refactor(service): 重构用户服务"
```

## 🔗 与其他窗口的关系

### 窗口1 - 前端 (D:\myproject\Test-Web)
- 前端调用本窗口提供的API
- 端口: 5174 → 3001

### 窗口3 - Electron (D:\myproject\Test-Web-electron)
- Electron应用使用本窗口的API
- 需要CORS配置

### 窗口4 - 测试 (D:\myproject\Test-Web-testing)
- 运行API集成测试
- 验证后端功能

## 🔍 故障排查

### 端口被占用
```bash
# Windows
netstat -ano | findstr :3001
taskkill /PID <PID> /F

# 使用其他端口
cross-env PORT=3002 npm run backend:dev
```

### 数据库连接失败
```bash
# 检查PostgreSQL状态
npm run db:status

# 重新初始化
npm run db:init
```

### 依赖问题
```bash
# 重新安装
npm install

# 清理缓存
npm cache clean --force
npm install
```

## 📚 相关文档

### 本地文档
- 项目README: `../README.md`
- API文档: `backend/docs/API.md`
- 数据库Schema: `backend/docs/DATABASE.md`

### Worktree相关
- 工作树列表: `git worktree list`
- 合并指南: `../.dev/WORKTREE_MERGE_GUIDE.md`
- 快速参考: `../.dev/QUICK_START_REFERENCE.md`

## 💡 开发提示

### 热更新
- 使用 `nodemon` 自动重启
- 修改代码后自动生效
- 监听 `backend/src/` 目录

### 调试
```bash
# 启动调试模式
npm run backend:debug

# 使用 VS Code 调试
# F5 启动调试配置
```

### 性能监控
```bash
# 查看API性能
npm run backend:profile

# 查看内存使用
npm run backend:memory
```

## 🎯 当前任务建议

作为后端开发窗口，可以专注于：

1. **API开发**
   - 创建新的API端点
   - 优化现有API性能
   - 添加API文档

2. **数据库操作**
   - 设计数据表结构
   - 创建迁移脚本
   - 优化查询性能

3. **业务逻辑**
   - 实现核心业务功能
   - 添加数据验证
   - 优化算法

4. **测试**
   - 编写单元测试
   - API集成测试
   - 性能测试

## 🔒 安全注意事项

- ✅ 使用环境变量存储敏感信息
- ✅ 实施JWT认证
- ✅ 验证所有输入
- ✅ 防止SQL注入
- ✅ 实施CORS策略

## 🚦 状态检查

```bash
# 检查服务状态
curl http://localhost:3001/api/health

# 检查数据库连接
npm run db:ping

# 查看日志
npm run backend:logs
```

---

**最后更新**: 2025-10-06  
**分支**: feature/backend-api-dev  
**端口**: 3001  
**状态**: ✅ 开发就绪

**开始工作**: `npm run backend:dev`

