# 🪟 窗口4 - 测试与维护环境

## 📍 当前位置
- **工作目录**: `D:\myproject\Test-Web-testing`
- **Git 分支**: `test/integration-testing`
- **主要职责**: 测试编写、代码质量检查、项目维护、Bug修复

## 🎯 工作目标
作为**窗口4 - 测试与维护窗口**，专注于：
1. 单元测试编写和运行
2. 集成测试和E2E测试
3. 代码质量检查（ESLint、TypeScript）
4. 依赖管理和更新
5. Bug修复和验证

## 🚀 快速启动

```bash
# 单元测试（监听模式）
npm run test:watch

# 运行所有测试
npm run test

# UI测试界面
npm run test:ui

# E2E测试
npm run e2e
```

## 📂 项目结构
```
tests/                  # 测试文件
├── unit/              # 单元测试
├── integration/       # 集成测试
├── e2e/               # E2E测试
└── fixtures/          # 测试数据

frontend/
├── components/
│   └── __tests__/     # 组件测试
└── hooks/
    └── __tests__/     # Hooks测试

backend/
└── tests/             # 后端测试
```

## 🧪 测试命令

### 单元测试
```bash
# 运行所有单元测试
npm run test

# 监听模式（推荐）
npm run test:watch

# UI界面
npm run test:ui

# 测试覆盖率
npm run test:coverage

# 运行单个测试文件
npm run test -- ComponentName.test.tsx
```

### E2E测试
```bash
# 运行E2E测试
npm run e2e

# UI模式
npm run e2e:ui

# 有头模式（显示浏览器）
npm run e2e:headed

# 调试模式
npm run e2e:debug
```

### 集成测试
```bash
# API集成测试
npm run test:integration

# 数据库集成测试
npm run test:db
```

## 🔍 代码质量检查

### ESLint
```bash
# 检查代码
npm run lint

# 自动修复
npm run lint:fix

# 检查特定目录
npm run lint -- frontend/components/
```

### TypeScript
```bash
# 类型检查
npm run type-check

# 生成类型定义
npm run type:generate
```

### Prettier
```bash
# 格式化代码
npm run format

# 仅检查格式
npm run format:check

# 格式化特定目录
npm run format -- "frontend/**/*.{ts,tsx}"
```

## 📝 测试编写规范

### 单元测试示例
```typescript
// Component.test.tsx
import { render, screen } from '@testing-library/react';
import { MyComponent } from './MyComponent';

describe('MyComponent', () => {
  it('should render correctly', () => {
    render(<MyComponent />);
    expect(screen.getByText('Hello')).toBeInTheDocument();
  });
});
```

### E2E测试示例
```typescript
// login.spec.ts
import { test, expect } from '@playwright/test';

test('user can login', async ({ page }) => {
  await page.goto('http://localhost:5174');
  await page.fill('[name="username"]', 'testuser');
  await page.fill('[name="password"]', 'password');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL('/dashboard');
});
```

### 提交规范
```bash
git add tests/
git commit -m "test: 添加用户登录单元测试"
git commit -m "test(e2e): 添加压力测试E2E场景"
git commit -m "fix(test): 修复测试mock数据"
```

## 🔗 与其他窗口的关系

### 窗口1 - 前端 (D:\myproject\Test-Web)
- 测试前端组件和Hooks
- 验证UI功能
- 端口: 5174

### 窗口2 - 后端 (D:\myproject\Test-Web-backend)
- 测试API端点
- 集成测试
- 端口: 3001

### 窗口3 - Electron (D:\myproject\Test-Web-electron)
- Electron应用E2E测试
- 主进程单元测试

## 🔍 故障排查

### 测试失败
```bash
# 清理测试缓存
npm run test:clear-cache

# 重新安装依赖
npm install

# 运行单个失败的测试
npm run test -- --testNamePattern="specific test name"
```

### E2E测试超时
```bash
# 增加超时时间
npm run e2e -- --timeout=60000

# 检查服务是否运行
curl http://localhost:5174
curl http://localhost:3001/api/health
```

### TypeScript错误
```bash
# 重新生成类型
npm run type-check

# 清理构建缓存
rm -rf node_modules/.cache
npm install
```

## 📊 测试覆盖率

### 查看覆盖率报告
```bash
# 生成覆盖率报告
npm run test:coverage

# 打开HTML报告
# coverage/index.html
```

### 覆盖率目标
- 单元测试: > 80%
- 集成测试: > 60%
- E2E测试: 关键路径100%

## 🛠️ 维护任务

### 依赖管理
```bash
# 检查过期依赖
npm outdated

# 更新依赖
npm run deps:update

# 检查安全漏洞
npm audit

# 修复安全漏洞
npm audit fix
```

### 项目清理
```bash
# 清理构建文件
npm run clean

# 完全清理（包括node_modules）
npm run clean:all

# 清理Git未跟踪文件
git clean -fd
```

### 代码质量检查
```bash
# 完整检查流程
npm run ci:check

# 等同于
npm run type-check && npm run lint && npm run test
```

## 📚 相关文档

### 测试框架文档
- Vitest: https://vitest.dev/
- Playwright: https://playwright.dev/
- Testing Library: https://testing-library.com/

### 本地文档
- 项目README: `../README.md`
- 测试指南: `tests/README.md`
- 贡献指南: `../CONTRIBUTING.md`

### Worktree相关
- 工作树列表: `git worktree list`
- 合并指南: `../.dev/WORKTREE_MERGE_GUIDE.md`
- 快速参考: `../.dev/QUICK_START_REFERENCE.md`

## 💡 开发提示

### 测试调试
```bash
# 调试单个测试
npm run test:debug -- ComponentName.test.tsx

# 使用VS Code调试
# F5 启动测试调试配置
```

### 测试性能
```bash
# 并行运行测试
npm run test -- --parallel

# 仅运行失败的测试
npm run test -- --only-failed

# 禁用并行
npm run test -- --no-parallel
```

### Mock数据
```typescript
// 使用MSW mock API
import { rest } from 'msw';
import { setupServer } from 'msw/node';

const server = setupServer(
  rest.get('/api/users', (req, res, ctx) => {
    return res(ctx.json({ users: [] }));
  })
);
```

## 🎯 当前任务建议

作为测试与维护窗口，可以专注于：

1. **测试编写**
   - 提高测试覆盖率
   - 编写E2E测试场景
   - 完善集成测试

2. **代码质量**
   - 修复ESLint警告
   - 解决TypeScript错误
   - 优化代码结构

3. **Bug修复**
   - 重现和验证Bug
   - 编写回归测试
   - 确保修复不引入新问题

4. **项目维护**
   - 更新依赖包
   - 清理过期代码
   - 优化构建配置

## 🔒 测试最佳实践

### 单元测试
- ✅ 测试单一功能
- ✅ 独立且可重复
- ✅ 快速执行
- ✅ 使用有意义的测试名称

### 集成测试
- ✅ 测试模块间交互
- ✅ 使用真实依赖
- ✅ 覆盖关键路径

### E2E测试
- ✅ 模拟真实用户行为
- ✅ 测试完整流程
- ✅ 关注用户体验

## 🚦 持续集成

### CI检查清单
```bash
# 本地运行CI检查
npm run ci:check

# 包含:
# 1. TypeScript类型检查
# 2. ESLint代码检查
# 3. 单元测试
# 4. 构建验证
```

## 📈 性能测试

```bash
# 运行性能测试
npm run test:performance

# 查看性能报告
npm run test:profile
```

---

**最后更新**: 2025-10-06  
**分支**: test/integration-testing  
**测试框架**: Vitest + Playwright  
**状态**: ✅ 开发就绪

**开始工作**: `npm run test:watch`

